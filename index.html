<!DOCTYPE html>
<html>
<head>

  <title>freealbert's blog </title>
  <meta charset="utf-8">
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true},
    "HTML-CSS": { availableFonts: ["TeX"], linebreaks: {automatic: true}},
    TeX: {equationNumbers: {autoNumber: ["AMS"], useLabelIds: true}},
    <!-- "HTML-CSS": {linebreaks: {automatic: true}}, -->
    SVG: {linebreaks: {automatic: true}}
});
</script>

<script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script> 
-->


  <link rel="stylesheet" href="./theme/css/style.css">
<!-- <link rel="stylesheet" href="./theme/css/styles/default.css"> -->
<!-- <script src="./theme/css/highlight.pack.js"></script> -->
<!-- <script>hljs.initHighlightingOnLoad();</script> -->
<!-- <link rel="stylesheet" href="./theme/css/pygments.css"> -->
<!-- <link rel="stylesheet" href="./theme/css/pygments_emacs.css"> -->
<link rel="stylesheet" href="./theme/css/pygments_friendly.css">


    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


  <!-- google analysis  -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34015459-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

 <link href="./" type="application/atom+xml" rel="alternate" title="freealbert's blog ATOM Feed" />

</head>
<body>
  <div class="container">
    <div class="header">
      <a href="./index.html">freealbert's blog</a>
      <!-- <span>--Virya</span> -->
    </div>
    <div class="navigation">
      <ul>
	      <li><a href="./index.html">Home</a></li>
	        
	          <!-- <li><a href="./pages/pages/about.html">About</a></li> -->
            <li><a href="./pages/about.html">About</a></li>
	        
        <!-- <li><a href="./about.html">About</a></li>   -->
	      <li><a href="./tags.html">Tags</a></li>
	      <!-- <li><a href="./archives.html">Archives</a></li> -->
      </ul>
    </div>
    <div class="body">
      


  
  <div class="entry-overview">
    <div class="date">
      01 Feb 2013
    </div>
    <div class="detail">
      <h1><a href="./yue-du-shu-ji-lu-2013.html">一月读书记录，2013</a> </h1>
      <!-- <div class="summary">
	<p><p>整个一月份，我只读完了三本书。</p>
<ul>
<li>《西游日记》 今何在</li>
</ul>
<p>以西游为框架，今何在写的是一个让读者一路笑过去的悲剧，被扼杀的抗争，被压抑的自由，被抹去的记忆和存在。</p>
<p>在时而笑，时而悲的反复后，作者用戏谑的笔法，荒诞的故事呈现给我们的的的确确是一个真正的西游。虽然是网络文学，今何在的作品却绝不同于起点上的小白文，这从十来万字便敢出版一本书就可以看出，也不同于新概念作文选上那些矫揉造作的文字。作者时不时有些类似于禅宗的当头棒喝似的言语，令人不得好好沉思一番。
总而言之，今何在是个神棍。</p>
<ul>
<li>《我的征途是星辰大海》 今何在</li>
</ul>
<p>还是今何在这个神棍的书，该书以中日甲午战争为框架，时间却放在了未来，而人物却是三国那些耳熟能详的名字。
主人公陆逊陆伯言毫无疑问是个天才，但整个故事，或者说百年前的历史告诉我们，大厦指将倾之时，个人即使再天才，也难以拯救一个国家。
联想到明年又是甲午年，庞大帝国是否仍旧会重蹈悲剧，作为中华儿女还是很担忧的。
正本书，我最欣赏后记中的一句话，特地摘录如下：</p>
<blockquote>
<p>不论我是否去记录，在往昔与未来的无限岁月中，仍会有人奋起，有人沉沦，有人成为英雄，有人扮演小丑，有人挺身而出，有人迷茫消沉。但这个国家仍会生生不息，有如亿万年来波澜壮阔的长河。</p>
</blockquote>
<ul>
<li>《万历十五年》 黄仁宇</li>
</ul>
<p>这本书，是作者最负盛名的著作，之前便屡屡听人提起，这一回终于咬定牙关啃了下来。之所以要咬定牙关，在于这本书并不易读，我个人认为原因有二：
    * 毕竟这还是一本学术著作，行文严谨考究，有着大量细碎的史料，我们这种看惯了如《明朝那些事儿》那样风趣幽默或者细说历史的读者，自然在阅读上会显得吃力不少。 
    * 这本书最早由英文写成，后经作者自己译成中文。但要知道，作者作为国民党军官在建国后久居于美国，他的白话文在我们看来，又有浓厚的文言色彩，这也是那个时代文人作品的特点。</p>
<p>这本书，详述了万历、张居正、申时行、海瑞、戚继光、李贽六人以及当时整个中国的失败与悲剧，这种全面的失败，也是体制的失败，而作者在书中屡屡提及的便是<em>“用道德代替法律”</em>。</p>
<p>关于这个主旨，我是赞同的，但需要补充的事，是否否定用“道德代替法律”，采用近代西方的根据专业知识和技能任用官吏便可以走出当时中国的困境了呢？
恰好，我又看了北大的公开课<em><a href="http://v.163.com/special/cuvocw/gudaizhengzhiwenhua.html">中国古代政治与文化</a></em>，头三集便是讨论这个问题。</p>
<p>这是门非常精彩的课程，全部16集，除了吃饭睡觉外，我是一口气看完的，强烈推荐！</p></p>
      </div> -->
    </div>
  </div>
  
  <div class="entry-overview">
    <div class="date">
      06 Sep 2012
    </div>
    <div class="detail">
      <h1><a href="./emacs-preludejian-jie.html">Emacs-Prelude简介</a> </h1>
      <!-- <div class="summary">
	<p><ul>
<li><a href="#whyPrelude">为什么需要Prelude</a></li>
<li><a href="#installPrelude">安装Prelude</a></li>
<li><a href="#reviewPrelude">再次审视Prelude</a></li>
<li><a href="#customPrelude">定制Prelude</a></li>
<li><a href="#aboutAuthor">关于作者</a></li>
<li><a href="#reference">参考资料</a></li>
</ul>
<h2><div id="whyPrelude">为什么需要Prelude</div></h2>
<p>前天重装了一下Ubuntu，忘记了备份辛辛苦苦才攒起来的 .emacs配置文件。由于我不会Emacs Lisp，再重新搜罗一下还是件挺费力的事，<a href="http://shiquanwang.github.com/">qq987</a>给我推荐了Emacs-Prelude，我尝试了一下，目前感觉很不错，跟大家分享一下。</p>
<p>在使用Emacs的时候，我们都会有这样的感觉，Emacs真是一个太棒的编辑器，可以根据自己的需求个性化的定制。但这其中有一个问题，在享受个性化定制带来的便利之前，我们有一个不得不经过的序幕或者说前奏曲，写.emacs文件。这需要用到Emacs Lisp，应该说是相当高的门槛。当然你可以同我一样，不会Emacs Lisp，从那些牛人的配置里扒一点适合自己的，勉强凑合一个，可是这个也很花时间啊，而且出了一堆error还不知道怎么办。总之，要是想将Emacs调教的千依百顺，这光源式养成计划长路漫漫，且并不平坦。</p>
<blockquote>
<p><strong>"Get me out of the Prelude, I just want to use Emacs" </strong></p>
</blockquote>
<p>Prelude的出现，很大程度上的解决了这个问题，它会自动将Emacs配置得比较舒适顺手，让你直接跳过那个并不愉悦的前奏曲，这也就是Prelude这个名字的由来。</p>
<h2><div id="installPrelude">安装Prelude</div></h2>
<ul>
<li>
<h3>Emacs 24</h3>
Prelude需要Emacs 24，且不向前兼容，目前从Ubuntu的源里安装的Emacs还是23，如果你跟我一样，请先卸载。后执行如下代码（当然可以自己动手编译，不过我等懒人还是喜欢简单直接的，不过这个源实在有点慢）</li>
</ul>
<div class="codehilite"><pre>    sudo add-apt-repository ppa:cassou/emacs
    sudo apt-get update
    sudo apt-get install emacs-snapshot
</pre></div>


<ul>
<li>
<h3>git &amp; curl</h3>
由于需要用到git 和 curl，需要先安装一下</li>
</ul>
<div class="codehilite"><pre>    sudo apt-get install git curl
</pre></div>


<ul>
<li>
<h3>安装</h3>
在安装之前，请先确保将原有的 .emacs文件和 .emacs.d文件夹删掉，我之前反复安装不成功，就是这个原因，多亏了Tux的提醒。安装的过程仍然一贯的简单</li>
</ul>
<div class="codehilite"><pre>    curl -L https://github.com/bbatsov/prelude/raw/master/utils/installer.sh | sh
</pre></div>


<p>更多的安装方法可以点<a href="http://batsov.com/prelude/">这里</a> 和<a href="https://github.com/bbatsov/prelude">这里</a>。
事实上，应该只要从其<a href="https://github.com/bbatsov/prelude">github的项目主页</a>上将文件夹下下来，再重命名成 .emacs.d 放到Home下就可以了。</p>
<p>之后，启动Emacs，Prelude会自动安装不少东西，请稍微耐心等待一下。再次启动后，就会发现Emacs的背景色变成如下了，这是因为Prelude的配色方案默认启用了zenburn主题。</p>
<p><img alt="" src="http://i.imgur.com/B2rRm.png" /></p>
<h2><div id="reviewPrelude">再次审视Prelude</div></h2>
<p>至此，Prelude的安装便算完成了。可是Prelude对于我一个一点也不会Emacs Lisp的菜鸟来说，还只是一只一无所知的黑箱子，我只知道Prelude预设了很多便利给我，但究竟是哪些呢，我又该怎么用呢？</p>
<p>我适当的摸索了一些，写在下面，如果你知道更多，也请告诉我～</p>
<h3>Prelude的便利</h3>
<p>首先看上图，我们可以知道Prelude至少给了我们以下这些福利：</p>
<ul>
<li>取消了启动画面</li>
<li>取消了菜单栏和工具栏</li>
<li>启用了一个不错的配色主题
  <a href="http://slinky.imukuppi.org/zenburn/">zenburn</a></li>
<li>显示行号和列号</li>
</ul>
<p>接触更多，我们还会发现更多惊喜的，比如如下这个简短的hello.py</p>
<p><img alt="" src="http://i.imgur.com/lDyRb.png" /></p>
<ul>
<li>启用了yasnippet</li>
<li>启用了whitespace mode</li>
<li>引号和括号自动补全</li>
<li>高亮当前所在的行</li>
<li>minibuffer里的路径文件夹补全</li>
</ul>
<p>其中，在每行的末尾都有一个美元符号$，以及缩进均有小点来标识，这就是whitespace mode，它实在是太赞了！</p>
<p>以前，在markdown模式下，yasnippet一直都不能用，我也搜寻了一些方法，但始终无效，现在这个问题不复存在，可以尽情的在编写markdown时使用yasnippet。</p>
<h3>更多便利</h3>
<p>Prelude预先定义了不少快捷键，我挑选了一些我常用的列举在下，更多的请阅读 <a href="https://github.com/bbatsov/prelude/blob/master/prelude/prelude-global-keybindings.el"> prelude-global-keybindings.el </a> </p>
<table border="1" width="600">
    <thead>
        <tr>
            <th>功能描述</th>
            <th>快捷键</th>
            <th>备注</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>redo</td>
            <td>C-/</td>
            <td>replacement of "C-x u"</td>
        </tr>
        <tr>
            <td>backward-kill-word</td>
            <td>C-M-h</td>
            <td>You know, like Readline.>
        </tr>
        <tr>
            <td>align-regexp</td>
            <td>C-x \\</td>
            <td>Align your code in a pretty way.</td>
        </tr>
        <tr>
            <td>text-scale-increase</td>
            <td>C-+</td>
            <td>Font size increase</td>
        </tr>
        <tr>
            <td>eshell</td>
            <td>C-x m</td>
            <td>Start eshell or switch to it if it's active.</td>
        </tr>
    </tbody>
</table>

<p>容许我再对其中某两个快捷键罗嗦几句，因为我实在太喜欢了～</p>
<ul>
<li>
<p>align-regexp C-x \</p>
<p>套用<a href="http://lucifr.com/">Lucifr</a>的大作
<a href="http://lucifr.com/139225/sublime-text-2-tricks-and-tips/">Sublime Text 2 入门及技巧</a>
中的例子：</p>
<p>对于某些喜欢整齐的程序员来说，看到下面这种情况可能是让其无法忍受的：</p>
</li>
</ul>
<div class="codehilite"><pre>    <span class="kd">var</span> <span class="nx">joe</span> <span class="o">=</span> <span class="s1">&#39;joe&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">johnny</span> <span class="o">=</span> <span class="s1">&#39;johnny&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">quaid</span> <span class="o">=</span> <span class="s1">&#39;quaid&#39;</span><span class="p">;</span>
</pre></div>


<p>一定要改成这样才会安心：</p>
<div class="codehilite"><pre>    <span class="kd">var</span> <span class="nx">joe</span>    <span class="o">=</span> <span class="s1">&#39;joe&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">johnny</span> <span class="o">=</span> <span class="s1">&#39;johnny&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">quaid</span>  <span class="o">=</span> <span class="s1">&#39;quaid&#39;</span><span class="p">;</span>
</pre></div>


<p>这个功能可以通过输入C-x \后再输入等号= （也就是你想要对其的符号）来对齐。</p>
<ul>
<li>redo C-/</li>
</ul>
<p>以前我用CUA-mode，原因只有一个，那就是C-x u不方便，Prelude很贴心的设置
了C-/来替代。</p>
<h3>Prelude的不便</h3>
<p>就像硬币总是有两面一样，Prelude预置的许多功能可以极大的方便我们，但事情总没有我们预想的那么十全十美，对我来说，Prelude至少有以下不足：</p>
<ul>
<li>禁用了方向键以及Home,End,Delete键</li>
<li>缺少快速注释和反注释</li>
<li>缺少行号的显示</li>
</ul>
<p>其中的第一点，称其不足，应该说委屈Prelude了，我想作者一定是故意为之，禁用了上下左右方向键以及Home，End，Delete，那么我们只能以C-p，C-n，C-b，C-f和C-a，C-e，C-d来代替，更加纯粹的Emacs，不是吗？俗话说，水至清则无鱼，作为笔记本用户，对此表示压力山大，左手经常要缩成鸡爪状，很不舒服。为什么要跟自己过不去呢？</p>
<p>PS: <a href="http://pxqing.me/">pXq</a> 现在已经在研究如何制造脚踏板了～</p>
<p>关于如何消除这些不便，我们将在下一节讨论。</p>
<h2><div id="customPrelude">定制Prelude</div></h2>
<p>Prelude不能让你100%的满意，没关系，我们可以自己动手，在~/.emacs.d文件夹下有一个 personal文件夹，
这里你只需新建一个后缀命是el的文件，即可开始定制，如我，是
myconfig.el.</p>
<ul>
<li>
<h3>重新启用方向键</h3>
</li>
</ul>
<div class="codehilite"><pre>    <span class="c1">;; Re-enable the arrow keys</span>
    <span class="p">(</span><span class="nb">defun</span> <span class="nv">disable-guru-mode</span> <span class="p">()</span>
    <span class="p">(</span><span class="nv">guru-mode</span> <span class="mi">-1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;prelude-prog-mode-hook</span> <span class="ss">&#39;disable-guru-mode</span> <span class="no">t</span><span class="p">)</span>
</pre></div>


<p>除了方向键，还有Home,End,Delete这些键也同时恢复了功能。</p>
<ul>
<li>
<h3>设置字体</h3>
</li>
</ul>
<div class="codehilite"><pre>    <span class="c1">;;设置字体</span>
    <span class="p">(</span><span class="nv">set-frame-font</span> <span class="s">&quot;monaco-12&quot;</span><span class="p">)</span>
</pre></div>


<p>显示代码我用的是monaco，感觉很不错，如果系统还没有安装，可以Google一下。
字体安装在Ubuntu下极其简单，只需要双击打开字体文件（一般是OTF或者TTF文
件）后，点击install即可。</p>
<p>其实Emacs会读取系统默认的字体，比如我在myunity里就将等宽字体
(Monospace)设置成了monaco，其余均是苹果冬青黑，所以这一行配置其实是句废话。</p>
<ul>
<li>
<h3>更换颜色主题</h3>
</li>
</ul>
<p>配色主题采用的是，(almost-monokai)[https://github.com/lut4rp/almost-monokai/]，顾名思义它是仿照TextMate下的monokai主题。由于它需要依赖<a href="http://www.emacswiki.org/emacs/ColorTheme">color theme</a>，所以我们需要先安装它。</p>
<p>1.安装color theme
M-x package-install 回车后继续输入color-theme再回车即可。</p>
<p>2.从<a href="https://github.com/lut4rp/almost-monokai/">almost-monokai的Github主页</a>上将其下载并解压后，把color-theme-almost-monokai.el文件放到~/.emacs.d/themes文件夹下，然后在配置文件（我是~/.emacs.d/personal/myconfig.el)内加入如下代码即可</p>
<div class="codehilite"><pre>    <span class="c1">;; color theme</span>
    <span class="p">(</span><span class="nv">load-file</span> <span class="s">&quot;~/.emacs.d/themes/color-theme-almost-monokai.el&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">color-theme-almost-monokai</span><span class="p">)</span>
</pre></div>


<ul>
<li>
<h3>注释和反注释</h3>
</li>
</ul>
<div class="codehilite"><pre>    <span class="c1">;; Comment and Uncomment</span>
    <span class="p">(</span><span class="nb">defun</span> <span class="nv">comment-or-uncomment-line-or-region</span> <span class="p">()</span>
    <span class="s">&quot;Comments or uncomments the current line or region.&quot;</span>
    <span class="p">(</span><span class="nv">interactive</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">region-active-p</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">comment-or-uncomment-region</span> <span class="p">(</span><span class="nv">region-beginning</span><span class="p">)</span> <span class="p">(</span><span class="nv">region-end</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">comment-or-uncomment-region</span> <span class="p">(</span><span class="nv">line-beginning-position</span><span class="p">)</span> <span class="p">(</span><span class="nv">line-end-position</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="p">)</span>
    <span class="p">(</span><span class="nv">global-set-key</span> <span class="s">&quot;\M-,&quot;</span> <span class="ss">&#39;comment-or-uncomment-line-or-region</span><span class="p">)</span>
</pre></div>


<p>这里我们将M-,设置为注释和反注释的快捷键。当选中某块区域时，可以将该区
域注释或者反注释；而当不选中时，则对当前行进行操作。</p>
<ul>
<li>
<h3>取消 whitespace-mode</h3>
我很喜欢 whitespace-mode，但也看到不少人不喜欢它。不喜欢，那便可以取消
它，代码如下:</li>
</ul>
<div class="codehilite"><pre>    <span class="p">(</span><span class="nv">add-hook</span> <span class="ss">&#39;prog-mode-hook</span> <span class="ss">&#39;prelude-turn-off-whitespace</span> <span class="no">t</span><span class="p">)</span>
</pre></div>


<h2><div id="aboutAuthor">关于作者</div></h2>
<p>Prelude的作者名叫<strong>Bozhidar Ivanov Batsov</strong>，来自<strong>保加利亚</strong>的Veliko
Tarnovo，目前居住于其首都<em>Sofia</em>。</p>
<p>Batsov是一家主打商务社交的网站<a href="https://tradeo.com/">tradeo.com</a>的
Technical Lead，负责开发基于Ruby on Rails的各种应用，曾经是Java工程师，
更早的时候则是C++工程师，而他的老本行则是基于Linux内核的嵌入式开发。
Batsov的经历，基本就是从低层逐渐往高层走的过程。</p>
<p>除了编程外，Bastov总是为Unix-like的操作系统着迷，最喜爱的编辑器是Emacs
（不然也不会制作Prelude啦），常用的shell是zsh，使用git来做版本控制。</p>
<p>最后上一张Bastov的靓照</p>
<p><img alt="Bastov" src="http://batsov.com/images/articles/bozhidar.jpg" /></p>
<h2><div id="reference">参考资料</div></h2>
<ol>
<li><a href="http://wikemacs.org/wiki/Prelude">WikEmacs-Prelude</a></li>
<li><a href="http://batsov.com/">Batsov's blog</a></li>
<li><a href="https://github.com/bbatsov/prelude">Prelude's github page</a></li>
<li><a href="http://batsov.com/prelude/">Prelude's Home</a></li>
<li><a href="http://www.linkedin.com/in/bozhidarbatsov">Batsov's linkedin profile</a></li>
<li><a href="https://tradeo.com/">tradeo.com</a></li>
</ol></p>
      </div> -->
    </div>
  </div>
  
  <div class="entry-overview">
    <div class="date">
      17 Aug 2012
    </div>
    <div class="detail">
      <h1><a href="./jie-jue-pygmentsyu-mathjaxde-chong-tu.html">解决Pygments与MathJax的冲突</a> </h1>
      <!-- <div class="summary">
	<p><p>MathJax是个人认为一个非常赞的开源项目，它是一个用来在浏览器上显示LaTeX数学公式的JavaScript引擎，本站的所有公式都是由它生成的。</p>
<p>Pygments是一个用来做语法高亮的利器，由pXq一直关注的Pocoo团队出品，Pocoo出品，必属精品。</p>
<p>但当两者共同工作时却出现了一点小意外，我发现数学公式中的字母颜色变淡了，情况如下：</p>
<p><img alt="" src="http://i.imgur.com/xI6ox.png" /></p>
<p>但我使用highlight.js来做高亮时，却又是好的。</p>
<p><img alt="" src="http://i.imgur.com/KdSfO.png" /></p>
<p>这说明是Pygments和MathJax起了冲突。听从pXq的建议，我将Pygments的主题从default换成了vim。Pygments产生主题的语句如下：</p>
<div class="codehilite"><pre><span class="nv">$ </span>pygmentize -S vim -f html &gt; pygments_vim.css
</pre></div>


<p>主题名称可以从<a href="http://pygments.org/demo/53718/">这里</a>找到，在<em>Use this style:</em> 的右边。</p>
<p>换了vim主题后，情况就变成这样了。</p>
<p><img alt="" src="http://i.imgur.com/0aNwi.png" /></p>
<p>从水木上得知，Pygments是只改变CSS的，那有这种状况应该是Pygments的某个CSS特性将MathJax原先的给替换掉了，导致公式里的字母也跟着代码一样变得花花绿绿。</p>
<p>现在的问题就是要使两者的CSS作用域分开，最后还是pXq想出了方法。刚学了一点CSS知识，我也现学现卖一下。</p>
<p>看一下Pygments产生的高亮CSS文件的随便一句代码：</p>
<div class="codehilite"><pre><span class="nc">.hll</span> <span class="p">{</span> <span class="k">background-color</span><span class="o">:</span> <span class="m">#ffffcc</span> <span class="p">}</span>
</pre></div>


<p>这句话表明，在整个网页中，只要属于hll类的元素都将具有background-color特性是#ffffcc这个效果。</p>
<p>但事实上，我们并不希望这样。我们希望整个页面包括数学公式中的字母默认就是黑色的，而只有代码段里的字母才会高亮。套用面向对象的说法，代码段里的效果是整体字母效果的一个子类。</p>
<p>看一下高亮代码段的HTML代码：</p>
<div class="codehilite"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;codehilite&quot;</span><span class="nt">&gt;&lt;pre&gt;</span>    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;kn&quot;</span><span class="nt">&gt;</span>import<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;nn&quot;</span><span class="nt">&gt;</span>PIL.Image<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;kn&quot;</span><span class="nt">&gt;</span>as<span class="nt">&lt;/span&gt;</span> <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;nn&quot;</span><span class="nt">&gt;</span>Image<span class="nt">&lt;/span&gt;</span>
<span class="nt">&lt;/pre&gt;&lt;/div&gt;</span>
</pre></div>


<p>可以看到他们都是属于codehilite类的，那么我们只要让Pygments产生的那个CSS文件只对codehilite类生效就可以了。具体方式是在每行的最开头加上 .codehilite  ，这样指定只有属于codehilite的代码才会高亮。形式如下：</p>
<div class="codehilite"><pre><span class="o">.</span><span class="n">codehilite</span> <span class="o">.</span><span class="n">hll</span> <span class="p">{</span> <span class="n">background</span><span class="o">-</span><span class="n">color</span><span class="p">:</span> <span class="c">#ffffcc }</span>
<span class="o">.</span><span class="n">codehilite</span> <span class="o">.</span><span class="n">c</span> <span class="p">{</span> <span class="n">color</span><span class="p">:</span> <span class="c">#60a0b0; font-style: italic } /* Comment */</span>
<span class="o">.</span><span class="n">codehilite</span> <span class="o">.</span><span class="n">err</span> <span class="p">{</span> <span class="n">border</span><span class="p">:</span> <span class="mi">1</span><span class="n">px</span> <span class="n">solid</span> <span class="c">#FF0000 } /* Error */</span>
<span class="o">.</span><span class="n">codehilite</span> <span class="o">.</span><span class="n">k</span> <span class="p">{</span> <span class="n">color</span><span class="p">:</span> <span class="c">#007020; font-weight: bold } /* Keyword */</span>
<span class="o">.</span><span class="n">codehilite</span> <span class="o">.</span><span class="n">o</span> <span class="p">{</span> <span class="n">color</span><span class="p">:</span> <span class="c">#666666 } /* Operator */</span>
<span class="o">...</span>
</pre></div>


<p>由此问题便解决了。</p>
<p><strong> 增加.codehilite只针对markdown文件，如果是rst文件，请将codehilite替换成highlight</strong></p></p>
      </div> -->
    </div>
  </div>
  
  <div class="entry-overview">
    <div class="date">
      13 Aug 2012
    </div>
    <div class="detail">
      <h1><a href="./shu-zi-tu-xiang-chu-li-shi-yan.html">数字图像处理实验</a> </h1>
      <!-- <div class="summary">
	<p><div id="part0"></div>

<ul>
<li><a href="#part1">写在最前面的废话</a></li>
<li><a href="#part2">如何开始之Python篇</a><ul>
<li><a href="#part2.1">Python简介</a></li>
<li><a href="#part2.2">模块介绍</a></li>
<li><a href="#part2.3">了解更多</a></li>
<li><a href="#part2.4">代码示例与骨架</a></li>
</ul>
</li>
<li><a href="#part3">如何开始之Matlab篇</a></li>
<li><a href="ji-ben-hui-du-bian-huan.html">EXP1 基本灰度变换</a> </li>
<li><a href="zhi-fang-tu-chu-li.html">EXP2 直方图处理技术</a> </li>
<li><a href="ping-hua-ji-zhu.html">EXP3 图像平滑技术</a> </li>
<li><a href="tu-xiang-rui-hua.html">EXP4 图像锐化技术</a>     <br />
</li>
</ul>
<h2><div id="part1">写在最前面的废话</div></h2>
<blockquote>
<p>既然课程名字叫作<strong><em>数字图像处理</em></strong>，而不是XXX程序语言设计，那么学生便有选择任何一种自己喜欢的语言完成实验的自由。</p>
</blockquote>
<p>本文最早的写作时间起于我刚学Python的时候，对着实验指导书码着同样是刚开始学习的matlab语言代码的，想着如果这个实验也可以用Python完成就好了。恰逢《Python科学计算》刚刚出版，我买了一本学习了一下（我是亚马逊上第二个购买的～），试着用Python完成了实验，心里也萌生了我也可以写一下Python版的实验指导书的念头。</p>
<p>在这个想法的牵引下，我修改了一下原先老师下发的实验指导书，从最初的Word版，用刚学会的Latex排成了PDF，顺便增加了一些我自己理解的实验原理。然后又尝试了下Beamer还有HTML5制作幻灯片，得出结论虽然PDF不是最佳形式，但幻灯片更加不是。最后我想我找到了，网页由于其天生的超链接特性，可以方便的在不同资源之间自由跳转，以前那种一言难尽的感觉终于没了。还有<a href="http://www.mathjax.org/">MathJax</a>这种优秀的开源项目，让呈现数学公式也变得容易。</p>
<p>过程中，我也收到了一些善意的建议，觉得这么做是徒劳的。我很清楚，不像同样开源的R之于统计领域，在通信这块，Matlab相比Python的优势实在巨大。开源不是万能的，科学计算方面，Python不论是文档还是社区都是远远不及，就性能而言，同样是其短板。其实更大的阻力来自于我自己的内心，我深知自己的水平，不管是这门课还是Python，连入门的门槛还没摸着，自娱自乐没事，误人子弟就罪孽深重了。也由此，这篇文章写写停停花了半年左右，现在我才发现，驱使我还在写的倒不是目的本身，而是这个过程。从一开始的LaTeX，到先前学着用Pelican，Github，带着我走进一个HTML+Javascript+CSS构成的Web世界，真的挺有趣的。</p>
<p>你现在正在访问的网站是由Python写成的，国内外很多著名网站比如<a href="http://www.douban.com/">豆瓣</a>，<a href="http://www.zhihu.com/">知乎</a>，<a href="http://dropbox.com/">DropBox</a>都是由Python写的。
当然本文并不是要讨论其在Web端的应用以及如何建一个网站，而是在另一个领域——科学计算，更精确点也就是如何用Python完成我们的数字图像处理实验。考虑到大部分人可能对新语言不感冒，我也安排了Matlab的部分。</p>
<p>本文一共六个部分，除了你现在在阅读的废话环节，还有对于初学者如何用Python或Matlab来完成本实验，以及四个完整的实验，包括了实验原理，内容步骤等。其中我会用Python给出代码骨架。由于我行文实在罗嗦，因此我强烈建议你当感觉不耐烦时，按下<a href="#part0">Home</a>键，返回页首，然后根据目录直奔目标。</p>
<h2><div id="part2">如何开始之Python篇</div></h2>
<h3><div id="part2.1">Python简介</div></h3>
<p>Python不同于我们之前学过的C/C++，她是一种解释性语言，这一点，本文的另一种备选语言Matlab也是相同的。没有编译这个环节，在程序写好后，便可以运行，当程序运行到有错误的时候便会停下来。一般来说，解释性语言的速度慢于编译型语言，但在现在我们的电脑上，这一点可以完全忽略了。</p>
<p>Matlab除了Matlab语言本身还有许许多多的工具箱（你很可能已经在数字信号处理的课堂上见识过信号处理工具箱），工具箱其实就是一堆函数。这些工具箱就是一个个扩展的模块，用来满足某些领域的需求。比如</p>
<ul>
<li>信号处理工具箱提供了丰富的信号处理方面的函数</li>
<li>符号数学工具箱扩展了原先只能做数值运算的Matlab使其也能够做符号运算</li>
<li>图像处理工具箱当然是用来做图像处理的，针对的就是本实验。</li>
<li>更多的工具箱，传送门在<a href="http://www.mathworks.cn/products/">这里</a></li>
</ul>
<p>同Matlba一样，Python也有许多的扩展类库，也可以称之为模块。我觉得，模块之于Python就像守护在雅典娜身边的圣斗士，团聚在其周围，扩充了其的应用领域和威力。下面这张图很好的表现了这一点：</p>
<p><img alt="Athena" src="https://github.com/freealbert/PyEE/blob/master/Python/pyintro/python_1.png?raw=true" /></p>
<h3><div id="part2.2">模块介绍</div></h3>
<p>上图中的模块构成了一个较为完整的科学计算的生态系统，当然对于本实验我们用不了这么多，只要稍微了解下下面的青铜五小强即可。</p>
<ul>
<li><a href="http://www.scipy.org/">Scipy</a>
Scipy是一个用于数学，科学和工程领域仿真的类库，提供了大量现成的函数。本实验中我们会使用其中的signal模块,约定模块导入的形式如下：</li>
</ul>
<div class="codehilite"><pre>    <span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="kn">as</span> <span class="nn">signal</span>
</pre></div>


<ul>
<li><a href="http://numpy.scipy.org/">Numpy</a>
Numpy模块是Scipy的基础，提供了对矩阵和多维数组的支持以及许多数值计算的函数。约定其导入形式如下:</li>
</ul>
<div class="codehilite"><pre>    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>


<ul>
<li>
<p><a href="http://matplotlib.sourceforge.net/">matplotlib</a>
matplotlib是一个二维图像绘制为主的类库，我们会用到其中的pylab模块和cm模块。</p>
<ul>
<li>pylab模块集成了一些常用的绘图函数，应付我们这次实验绰绰有余。</li>
<li>cm是colormap的缩写，指明的是表示颜色的数值和具体颜色之间以何种方式映射。拍照时的一些效果，如老照片（红铜色）就是由这个决定的。</li>
</ul>
<p>我们约定模块导入形式如下：</p>
</li>
</ul>
<div class="codehilite"><pre>    <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
</pre></div>


<p>有必要提醒一下，matplotlib的那些container的层次还是搞清一下最好，有点恼人的。</p>
<ul>
<li><a href="http://www.pythonware.com/products/pil/">PIL</a>
PIL是Python Image Library的缩写，顾名思义，是用来做图像处理的类库。
我们约定模块导入形式如下：</li>
</ul>
<div class="codehilite"><pre>    <span class="kn">import</span> <span class="nn">PIL.Image</span> <span class="kn">as</span> <span class="nn">Image</span>
</pre></div>


<ul>
<li><a href="http://code.google.com/p/pyopencv/">PyOpenCV</a>
OpenCV是一个基于C/C++语言的开源图像处理函数库，而PyOpenCV是其Python语言的绑定，由此，我们便可以抛开一想就头大的C++,使用Python直接调用其中的函数了。OpenCV功能十分强大，完成本实验小菜一叠，<strike>虽然并不一定要用到它，写在这儿，权做推荐了解一下。</strike>
<strong>怀着激动的心情还更新下～～～ PyOpenCV好久没有更新了，建议安装OpenCV最新的Python扩展库cv2，《Python科学计算》的<a href="http://hyry.dip.jp/">作者</a>将书中所有的PyOpenCV都用cv2重写了，<a href="http://blog.chinaunix.net/uid-23100982-id-3082055.html">这里</a>有说明和实例。</strong></li>
</ul>
<h3><div id="part2.3">了解更多</div></h3>
<p>由于篇幅有限，本文不可能对Python的语法来个详细的介绍，如果想用Python完成本实验，那么你只好去看别的教程了，幸好我们的要求并不高，一会会就可以将所能用到的语法一网打尽了，这么简单，你也可以边写程序边学习。</p>
<p>Python有着一个庞大的社区，网络上的好资源也是汗牛充栋。你大致了解下Python的简单语法，和一点点用Python做科学计算的知识就可以开始啦。下面是一些资源索引:</p>
<h4>推荐</h4>
<ul>
<li><a href="http://woodpecker.org.cn/abyteofpython_cn/chinese/index.html">简明 Python 教程</a> 推荐，可直接浏览，一天之内应该就可以写程序了。</li>
<li><a href="http://hyry.dip.jp:8000/pydoc/index.html">用Python做科学计算</a> 强烈推荐，这本书详细的介绍了我们会用到的类库（Numpy、Scipy、 matplotlib），目前也是唯一一本关于Python做科学计算的书。可以在图书馆借到，作者在网上放了大部分的内容，对我们实验而言已经足够了。</li>
<li><a href="http://hyry.dip.jp/">HYRY Studio</a> 《Python科学计算》作者的网站，汇集了博客、论坛等功能，里面的技术文章自然是很有价值，无需多言。让我印象更为深刻的是，里面记载的作者平时生活工作的点滴，让我感到就像身边稍微年长一点的前辈或是关系稍好的年轻老师，还是个好爸爸，觉得可亲，再看他的书，仿佛也更容易理解了。还有他女儿的日记呢，かわいい！</li>
</ul>
<h4>可参考</h4>
<ul>
<li><a href="http://www.scipy.org/NumPy_for_Matlab_Users/">NumPy for Matlab Users</a> Matlab与Numpy/Scipy有很多相似之处，也有很多不同。这篇文章比较了两者的差异，有兴趣者可以看看。</li>
<li><a href="http://matplotlib.sourceforge.net/gallery.html">matplotlib gallery</a> 有很多绘图的案例，也有相应的代码，我觉得是matplotlib绘图的最好教程了。</li>
<li><a href="http://www.pythonware.com/library/pil/handbook/index.htm">Python Imaging Library Handbook</a> PIL的官方手册，其中的Image模块我们会经常用到，虽然是英文，但也比较好懂，有兴趣可以看看。</li>
<li><a href="http://docs.scipy.org/doc/numpy/reference/">Numpy Reference Guide</a> Numpy的手册，非常详尽，不推荐阅读，因为太详尽会把你吓跑的。</li>
<li><a href="http://docs.scipy.org/doc/scipy/reference/">Scipy Reference Guide</a> Scipy手册，不推荐阅读，理由同上。</li>
</ul>
<h3><div id="part2.4">代码示例</div></h3>
<p>万事开头难，先选取实验一中的步骤2作为例子。</p>
<div class="codehilite"><pre><span class="c"># -*- coding:utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">pl</span>

<span class="k">def</span> <span class="nf">trans_line</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mf">0.35</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">r</span>
    <span class="k">elif</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mf">0.65</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mf">0.105</span><span class="o">+</span><span class="mf">2.6333</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mf">0.35</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="n">rice_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;rice.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">&#39;L&#39;</span><span class="p">))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">rice_0</span><span class="o">.</span><span class="n">shape</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ori_pic</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ori_pic</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rice_0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">ori_pic</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;input image&#39;</span><span class="p">)</span>

<span class="n">rice_1</span> <span class="o">=</span> <span class="n">rice_0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">rice_1</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">trans_line</span><span class="p">(</span><span class="n">rice_0</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">])</span>
<span class="n">result_pic</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">result_pic</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rice_1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">result_pic</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;output image&#39;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">trans_line</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
<span class="n">trans_line_curve_fig</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">trans_line_curve_fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
<span class="n">trans_line_curve_fig</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;s-r&#39;</span><span class="p">)</span>
<span class="n">trans_line_curve_fig</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">trans_line_curve_fig</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&#39;exp_1_2&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;exp_1_2.jpg&#39;</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre>            <span class="c"># -*- coding:utf-8 -*-</span>
</pre></div>


<p>Python中#开头的都是注释，通常注释都是不起作用的，但这句注释放在程序开头，是一句有意义的注释。它告诉Python解释器，里面的代码我是用utf-8编码。不然的话，Python解释器会默认程序使用的是ASCII码。ASCII码我们以前接触过，比如\n，\t，A是65，a的值是97等等，但有个缺点，不能表示中文（注释很容易出现中文），所以解释器遇到了它不认识的字符便会报错，添加这句注释，解释器就知道你用的是utf-8编码，便不会对中文报错了。</p>
<div class="codehilite"><pre>            <span class="kn">import</span> <span class="nn">Image</span>
            <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
            <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
            <span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">pl</span>
</pre></div>


<p>就像上文所说的那样，这段代码是告诉Python解释器我要引入相应的类库，并以相应的缩写表示，这是为了在之后用到时可以少打几个字，看起来也清爽一些，不然如果每处都要写matplotlib.pylab肯定很痛苦。</p>
<div class="codehilite"><pre>            <span class="k">def</span> <span class="nf">trans_line</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mf">0.35</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">r</span>
                <span class="k">elif</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mf">0.65</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="mf">0.105</span><span class="o">+</span><span class="mf">2.6333</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mf">0.35</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>           
                    <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">s</span>
</pre></div>


<p>这段代码我们是来定义如下这段函数的，对于每个像素的灰度值都进行变换。
\[ 
    s = \left\{
        \begin{array}{lr}
            0.3r， &amp; r &lt; 0.35 \\
            0.105 + 2.6333(r-0.35)， &amp; 0.35\leq r \leq 0.65\\
            1 + 0.3(r-1)， &amp; r &gt; 0.65.
            \end{array}
        \right.
\]</p>
<div class="codehilite"><pre>    <span class="n">rice_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;rice.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">&#39;L&#39;</span><span class="p">))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
</pre></div>


<p>这句话我们一下子做了很多事情。</p>
<ul>
<li>首先,我们用打开图片，Image.open('rice.png')是打开图片，其中图片应该是要同程序文件放在同一目录下，如果不是同一目录，那应该再加上系统路径。</li>
<li>convert('L')是用来确保读入的图像是灰度图像，因为有的图像是伪装成灰度图像的彩色图像。</li>
<li>经过上述步骤后，我们读入的其实还是一个Image类的对象，这一点，你可以在解释器中输入如下代码验证一下。
而np.asarray(Image_Object)这一步就是为了将Image对象转化为我们能处理的ndarray对象，也就是一个二维数组。</li>
</ul>
<div class="codehilite"><pre>    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s">&#39;rice.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s">&#39;L&#39;</span><span class="p">)</span>
    <span class="n">help</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</pre></div>


<ul>
<li>最后一步，由于我们读入图片的灰度是表示成0-255的，而要求的公式却是0-1的，所以我们要将灰度归一化。之所以要费事费力的写个float(255)
的原因想必你已经清楚了，如果还未明了，那么可以看一下我的另一片<a href="nao-ren-de-pythonchu-fa.html">拙作</a>。</li>
</ul>
<div class="codehilite"><pre><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="o">=</span> <span class="n">rice_0</span><span class="o">.</span><span class="n">shape</span>
</pre></div>


<p>这句话我们得到了读入矩阵的形状，其中M是行数，N是列数。shape是ndarray对象均有的属性。</p>
<div class="codehilite"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</pre></div>


<p>既然要画图，那当然要有一个画图的窗口啦。这句话就是产生一个画图的窗口，目前我们没有对fig的大小做任何设置，因而便自动采用默认值也就是figsize=(8, 6)，再后期，我们会遇到一个窗口里需要里放下很多张图片，那时小小的640*480窗口便不够用了（figsize中的每一个单位默认代表80个像素）。我们可以指明我们所要的窗口大小。</p>
<div class="codehilite"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span> <span class="c"># 1280*960</span>
</pre></div>


<div class="codehilite"><pre><span class="n">ori_pic</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>说曹操曹操就到，刚讲过可能一个窗口里需要放下好几副话，这不来了嘛。subplot很熟悉吧，matlab里用过，就是将窗口分为几行几列的子窗口。括号内的第一个参数是行数，第二个参数是列数，第三个参数指定需要将图画在那个子窗口上，这个序号就是从第一行第一列的那个子窗口开始从左往右数的序号。严格一点，这里的子窗口叫做Axes对象，这不ax1就是一个我们当前要画图的Axes对象。</p>
<div class="codehilite"><pre><span class="n">ori_pic</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rice_0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>


<p>Oh,yeah!到了这句，我们的任务已经阶段性完成了一大块了，接下去的都是类似的工作，恕我不能一一详述了。在上一句中，我们将第一个子窗口命名为ax1，现在便是用imshow函数将图片显示在ax1上。你可能会问，那为什么不是ax1.imshow(rice_0)这么简单了当就可以了呢？后面的又是什么东西？再次稍微罗嗦一下。</p>
<ul>
<li>cmap=cm.gray 指明我们的颜色映射采用灰度图像，否则的话，imshow会启用默认的伪彩色，你得到的就是一张花花绿绿的rice了，这当然不是你想要得。</li>
<li>norm=pl.Normalize(vmin=0,vmax=1) 指明灰度映射时，将0映射成0,255映射成1。为什么要这么指明呢？这就是matplotlib蛋疼的地方了，它会默认进行灰度拉伸，如果你的一张图像的灰度值范围是120-220，那么它就会把120映射成0,220映射成1,造成不必要的错误。关于这一点，更多的内容可以看我的<a href="jie-jue-matplotlibde-imshowxian-shi-shi-zhen.html">另一篇文章</a>和<a href="http://www.newsmth.net/nForum/#!article/Python/89271">水木上的帖子</a>。</li>
</ul>
<div class="codehilite"><pre><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;exp_1_2.jpg&#39;</span><span class="p">)</span>
</pre></div>


<p>没错，保存图像就是这样，Python单双引号是一样的，只要在引号内输入你要的文件名即可，格式便是你输入的格式。至此，恭喜你大功告成～</p>
<h2><div id="part3">如何开始之Matlab篇</div></h2>
<p>如果从头至尾看到这，想必你也清楚我的水平了，货真价实MADAO一个。。。</p>
<p>Matlab应该是在之前的课程中接触过了，如果感觉有困难的话，我也不误人子弟了，图书馆里的Matlab书籍汗牛充栋，人手一本绰绰有余，而这些工具书大体都相似，故也没什么好坏之分。</p>
<p><strong>出于整个页面排版的考虑，我将实验内容做成了独立的页面。如果你性急End一下就到了这边，那还请你再按下<a href="#part0">Home</a>键，返回页首再选取实验内容。</strong></p></p>
      </div> -->
    </div>
  </div>
  
  <div class="entry-overview">
    <div class="date">
      13 Aug 2012
    </div>
    <div class="detail">
      <h1><a href="./tu-xiang-rui-hua.html">图像锐化</a> </h1>
      <!-- <div class="summary">
	<p><h2>实验目的</h2>
<p>通过上机实验的手段巩固课堂上所学的关于图像锐化的相关知识，自己编写Sobel,Laplacian,Roberts算子对图像进行锐化的函数，感受不同的图像处理方法对最终图像效果的影响。</p>
<h2>方法技术介绍</h2>
<p>锐化处理的主要目的是突出图像中的细节或者增强被模糊了的细节，这种模糊不是由错误操作造成的，就是特殊图像获取方法的固有影响。从前面几个实验中可以知道，在空域用像素邻域平均法可以使图像变模糊，因为均值处理与积分类似，从逻辑角度可以断定，锐化处理可以用空间微分来完成。下文将分别讨论Sobel算子、Laplacian算子和Roberts算子这三个微分锐化算子。</p>
<h3>Sobel算子</h3>
<p>在图像处理中，一阶微分是通过梯度法实现的。对于函数$f(x,y)$在其坐标$(x,y)$上的梯度是通过如下二维列向量定义的：
\begin{equation}
    \nabla f =
    \left[
        \begin{array}{c}
            G_x\\
            G_y
        \end{array}
    \right]
    =
    \left[
        \begin{array}{c}
            \frac{\partial f}{\partial x}\\
            \frac{\partial f}{\partial y}
        \end{array}
    \right]
    \label{1}
\end{equation}
这个向量的模值由下式给出:</p>
<p>\begin{align}
\nabla f &amp; = mag(\nabla \bf f)  \\
{} &amp; = [G_x^2+G_y^2]^{\frac{1}{2}}  \\
{} &amp; = [(\frac{\partial f}{\partial x})^2+(\frac{\partial f}{\partial y})^2]^{\frac{1}{2}} 
\end{align}</p>
<p>Sobel算子属于一阶微分处理，对于一元函数$f(x)$，表达一阶微分的定义是一个差值:
\begin{equation}
    \frac{\partial f}{\partial x}=f(x+1)-f(x)
\end{equation}
对于水平和垂直两个方向，相应就有水平Sobel和垂直Sobel两个模板。
\[
    d_x=\left[
        \begin{array}{lcr}
            -1 &amp; -2 &amp; -1 \\
             0 &amp; 0 &amp; 0 \\
             1 &amp; 2 &amp; 1
        \end{array}
    \right]
    (水平Sobel)
\]
\[
    d_y=\left[
        \begin{array}{lcr}
            -1 &amp; 0 &amp; 1 \\
            -2 &amp; 0 &amp; 2 \\
            -1 &amp; 0 &amp; 1
        \end{array}
    \right]
    (垂直Sobel)
\]
综合考虑水平和垂直两个方向，则采用$\sqrt{d_x^2+d_y^2}$来生成图像，也就是$(4)$式。</p>
<h3>Laplacian算子</h3>
<p>下式用差分定义$x$方向上的二阶微分:
\begin{equation}
    \frac{\partial^2f}{\partial x^2}=f(x+1,y)+f(x-1,y)-2f(x,y)
\end{equation}
相应的，$y$方向上的二阶微分则为：
\begin{equation}
    \frac{\partial^2f}{\partial y^2}=f(x,y+1)+f(x,y-1)-2f(x,y)
\end{equation}
二维拉普拉斯数字实现可由这两个分量相加得到:
\begin{equation}
    \nabla^2f=[f(x+1,y)+f(x-1,y)+f(x,y+1)+f(x,y-1)]-4f(x,y)
\end{equation}
于是，Laplacian的算子形式便为:
\[
    \left[
        \begin{array}{lcr}
            0 &amp; -1 &amp; 0 \\
        -1 &amp; 4 &amp; -1 \\
            0 &amp; -1 &amp; 0 
        \end{array}
    \right]
\]
带对角线的Laplacian算子为:
\[
    \left[
        \begin{array}{lcr}
            -1 &amp; -1 &amp; -1 \\
            -1 &amp;  8 &amp; -1 \\
            -1 &amp; -1 &amp; -1
        \end{array}
    \right]
\]
假设有一个灰度值均匀变化的斜坡，其上的一阶微分值都不是零，但是二阶微分只有在斜坡的起始处和终点处才不为零。在图像中，边缘类似于这种过渡，进而可以得出一阶微分产生较粗的边缘，而二阶微分则细的多。可见二阶微分对细节的处理好于一阶微分。但考虑到孤立噪声点的情况，在该噪声点及其周围，二阶微分比一阶反应要强的多，也就是说二阶微分对噪声敏感。</p>
<h3>Roberts算子</h3>
<p>当对整幅图像进行$(4)$式的计算时，计算量很大，因此在实际操作中常用绝对值代替平方与开放运算近似求梯度的模值：
\begin{equation}
    \nabla f\approx |G_x|+|G_y|\\
\end{equation}
Roberts于1965年提出两种定义使用了交叉差分的算法：
\begin{eqnarray}
    G_x=f(x+1,y+1)-f(x,y)\\
    G_y=f(x+1,y)-f(x,y+1)
\end{eqnarray} 从而可以得到梯度的近似算法： 
\begin{equation} 
    \nabla f\approx |f(x+1,y+1)-f(x,y)|+|f(x+1,y)-f(x,y+1)| 
\end{equation}</p>
<h2>实验步骤</h2>
<h3>步骤1</h3>
<p>编写好Sobel,Laplacian,Roberts算子的相关函数，加入你自己编写的已经斐然成章的模块。</p>
<h3>步骤2</h3>
<p>读入cameraman.jpg图像文件，分别采用垂直方向的Sobel算子，Laplacian算子和$\sqrt{d_x^2+d_y^2}$的Sobel算子对原图进行锐化处理。将原图和处理后的图像绘在同一个窗口并保存。</p>
<p><img alt="" src="https://github.com/freealbert/freealbert_photo_1/blob/master/Tech/cameraman.png?raw=true" /></p>
<h3>步骤3</h3>
<div class="codehilite"><pre>1<span class="p">.</span>读入<span class="n">skeleton</span><span class="p">.</span><span class="n">jpg</span>文件，用带对角线的<span class="n">Laplacian</span>算子对其处理。
2<span class="p">.</span>将1<span class="p">)</span>的结果叠加到原始图像上。可看出噪声增强了（<span class="n">Laplacian</span>算子对噪声敏感），应设法降低。
3<span class="p">.</span>获取<span class="n">Sobel</span>图像并进行5<span class="o">*</span>5邻域平均，以减少噪声。
4<span class="p">.</span>获取2<span class="p">)</span>和3<span class="p">)</span>相乘图像，噪声得以减少。
5<span class="p">.</span>将4<span class="p">)</span>结果叠加到原始图像上。
6<span class="p">.</span>最后对5<span class="p">)</span>的图像做幂指数为0<span class="p">.</span>2的幂次变换
</pre></div>


<p><img alt="" src="https://github.com/freealbert/freealbert_photo_1/blob/master/Tech/skeleton.jpg?raw=true" /></p>
<p>将原图和处理后的图像绘在同一个窗口并保存。</p>
<h3>步骤4</h3>
<p>编写Roberts梯度锐化函数，对cell.jpg进行图像锐化，锐化图像的形成以下式为准：
\begin{equation}
    g(x,y)=
    \left\{
        \begin{array}{lr}
            L_G, &amp; G[f(x,y)]\geq T\\
            L_B, &amp; otherwise
        \end{array}
    \right.
\end{equation}
$L_G=255,L_B=0$,适当选择门限T。</p>
<p><img alt="" src="https://github.com/freealbert/freealbert_photo_1/blob/master/Tech/cell.jpg?raw=true" /></p>
<p>将原图和处理后的图像绘在同一个窗口并保存。</p>
<h3>实验报告要求</h3>
<p><strong>要是发现错误请在下面评论处指明噢！</strong></p></p>
      </div> -->
    </div>
  </div>
  

 
<!-- <div class="pagination"> -->
<!--    -->
<!--     <a href="#"> <b>&larr;</b>Previous</a> -->
<!--    -->

<!--    -->
<!--     <a href="./index2.html">Next<b>&rarr;</b></a> -->
<!--    -->
<!-- </div> -->
<div class="pagination">
<!-- <ul> -->

    <a href="#">&laquo; Previous</a>



    <a href="./index.html">1</a>

    <a href="./index2.html">2</a>

    <a href="./index3.html">3</a>



    <a href="./index2.html">Next &raquo;</a>


<!-- </ul> -->
</div>

    </div>

 


    <div class="footer">
      <p>&copy Copyright 2012 by freealbert</p>
      <p>Content licensed under the Creative Commons attribution-noncommercial-sharealike License. </p>
      <p>Contact me via
	<a href="http://github.com/freealbert">github</a>,
	<a href="mailto:jim2429212@gmail.com">mail</a>,
	<a href="http://weibo.com/u/1844630250">weibo</a>.
	<a href="http://fusion.google.com/add?source=atgs&feedurl=http%3A//dym.me">feed</a>
      </p>
    </div>
  </div>
</body>
</html>